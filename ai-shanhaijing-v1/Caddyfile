# Caddyfile for AI Shanhaijing Mobile Game
# 将此文件保存为 /etc/caddy/Caddyfile

your-domain.com {
    # 网站根目录
    root /var/www/ai-shanhaijing
    
    # 启用文件服务器
    file_server
    
    # 压缩优化
    encode zstd gzip
    
    # 安全头
    header {
        # HSTS
        Strict-Transport-Security "max-age=31536000; includeSubdomains; preload"
        # 内容安全策略
        Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; font-src 'self' data:; connect-src 'self';"
        # 防止点击劫持
        X-Frame-Options "DENY"
        # 防止MIME类型嗅探
        X-Content-Type-Options "nosniff"
        # XSS保护
        X-XSS-Protection "1; mode=block"
        # 引用策略
        Referrer-Policy "strict-origin-when-cross-origin"
        # 权限策略
        Permissions-Policy "camera=(), microphone=(), geolocation=()"
    }
    
    # 缓存策略
    handle /assets/* {
        header Cache-Control "public, max-age=31536000, immutable"
    }
    
    handle *.html {
        header Cache-Control "public, max-age=3600"
    }
    
    handle /* {
        header Cache-Control "public, max-age=1800"
    }
    
    # 错误处理
    handle_errors {
        respond "Error {http.error.status_code}: {http.error.status_text}"
    }
    
    # 日志配置
    log {
        output file /var/log/caddy/ai-shanhaijing.log {
            roll_size 100mb
            roll_keep 5
            roll_keep_for 720h
        }
        format json
    }
    
    # 访问日志
    log {
        output file /var/log/caddy/ai-shanhaijing-access.log {
            roll_size 100mb
            roll_keep 5
            roll_keep_for 720h
        }
    }
}

# 或者使用IP地址直接访问（如果不用域名）
:80 {
    root /var/www/ai-shanhaijing
    file_server
    encode zstd gzip
    log {
        output file /var/log/caddy/ai-shanhaijing-access.log
    }
}