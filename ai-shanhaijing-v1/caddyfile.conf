# Caddy配置文件模板
# 复制此内容到 /etc/caddy/Caddyfile 并修改域名

# 将 your-domain.com 替换为您的实际域名
# 如果没有域名，可以使用NAS的IP地址

your-domain.com {
    # 网站根目录
    root * /var/www/ai-shanhaijing

    # 启用文件服务器
    file_server

    # 启用压缩 (节省带宽)
    encode zstd gzip

    # 安全头部
    header {
        # 启用HSTS
        Strict-Transport-Security "max-age=31536000; includeSubdomains; preload"

        # 防止点击劫持
        X-Frame-Options "SAMEORIGIN"

        # 防止MIME类型嗅探
        X-Content-Type-Options "nosniff"

        # XSS保护
        X-XSS-Protection "1; mode=block"

        # 移除服务器信息
        -Server
    }

    # 静态资源处理
    handle /assets/* {
        # 长期缓存 (1年)
        header Cache-Control "public, max-age=31536000, immutable"

        # 启用文件服务器
        file_server
    }

    # 音效文件特殊处理
    handle /assets/sounds/*.m4a {
        # 设置正确的MIME类型
        header Content-Type "audio/mp4"

        # 启用文件服务器
        file_server
    }

    # SPA路由支持 (处理前端路由)
    handle {
        # 尝试匹配文件，否则返回index.html
        try_files {path} /index.html
    }

    # 日志配置
    log {
        # 输出到文件
        output file /var/log/caddy/ai-shanhaijing.log

        # 日志格式 (JSON格式，便于分析)
        format json

        # 包含额外字段
        level INFO
    }
}

# HTTP重定向到HTTPS (如果使用域名)
http://your-domain.com {
    # 重定向到HTTPS
    redir https://{host}{uri}
}

# 本地开发配置 (可选)
# 如果要在本地开发时使用，取消注释以下部分
# :8080 {
#     root * ./ai-shanhaijing
#     file_server
#     encode zstd gzip
#     handle /assets/* {
#         file_server
#     }
#     handle {
#         try_files {path} /index.html
#     }
# }