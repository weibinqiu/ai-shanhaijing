<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI山海经系统测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f0f0f0;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-section h3 {
            margin-top: 0;
            color: #333;
        }
        .test-button {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #2980b9;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
            background: #ecf0f1;
        }
        .success {
            background: #d5f4e6;
            color: #27ae60;
        }
        .error {
            background: #fadbd8;
            color: #e74c3c;
        }
        .feature-list {
            list-style-type: none;
            padding: 0;
        }
        .feature-list li {
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        .feature-list li:last-child {
            border-bottom: none;
        }
        .shortcut {
            background: #34495e;
            color: white;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>AI山海经系统测试</h1>

        <div class="test-section">
            <h2>新增功能总览</h2>
            <ul class="feature-list">
                <li><strong>存档系统</strong> - 支持多槽位存档、自动存档、读档功能</li>
                <li><strong>装备系统</strong> - 完整的装备栏、背包、物品掉落系统</li>
                <li><strong>音效系统</strong> - Web Audio API音效生成、背景音乐、音效控制</li>
                <li><strong>战斗增强</strong> - 装备属性加成、暴击率、闪避率</li>
                <li><strong>用户界面</strong> - 新的快捷键、控制提示、音效控制面板</li>
            </ul>
        </div>

        <div class="test-section">
            <h2>快捷键说明</h2>
            <ul class="feature-list">
                <li><span class="shortcut">F5</span> - 快速存档（槽位1）</li>
                <li><span class="shortcut">F9</span> - 快速读档（槽位1）</li>
                <li><span class="shortcut">F6</span> - 打开存档界面</li>
                <li><span class="shortcut">I</span> - 打开装备界面</li>
                <li><span class="shortcut">WASD</span> - 移动角色</li>
                <li><span class="shortcut">鼠标点击</span> - 寻路移动</li>
                <li><span class="shortcut">J/K/L</span> - 释放技能</li>
            </ul>
        </div>

        <div class="test-section">
            <h3>存档系统测试</h3>
            <button class="test-button" onclick="testSaveSystem()">测试存档系统</button>
            <div id="save-test-result" class="test-result" style="display:none;"></div>
        </div>

        <div class="test-section">
            <h3>装备系统测试</h3>
            <button class="test-button" onclick="testEquipmentSystem()">测试装备系统</button>
            <div id="equipment-test-result" class="test-result" style="display:none;"></div>
        </div>

        <div class="test-section">
            <h3>音效系统测试</h3>
            <button class="test-button" onclick="testAudioSystem()">测试音效系统</button>
            <div id="audio-test-result" class="test-result" style="display:none;"></div>
        </div>

        <div class="test-section">
            <h3>战斗系统测试</h3>
            <button class="test-button" onclick="testBattleSystem()">测试战斗系统</button>
            <div id="battle-test-result" class="test-result" style="display:none;"></div>
        </div>

        <div class="test-section">
            <h3>游戏启动测试</h3>
            <button class="test-button" onclick="startGame()">启动完整游戏</button>
            <div id="game-start-result" class="test-result" style="display:none;"></div>
        </div>
    </div>

    <script>
        function showResult(elementId, message, isSuccess) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = 'test-result ' + (isSuccess ? 'success' : 'error');
            element.style.display = 'block';
        }

        function testSaveSystem() {
            try {
                // 检查SaveManager类是否存在
                if (typeof SaveManager === 'undefined') {
                    showResult('save-test-result', 'SaveManager类未找到，请确保save-manager.js已正确加载', false);
                    return;
                }

                // 测试本地存储功能
                const testSaveData = {
                    test: true,
                    timestamp: Date.now()
                };
                localStorage.setItem('test_save', JSON.stringify(testSaveData));
                const loadedData = JSON.parse(localStorage.getItem('test_save'));

                if (loadedData.test === true) {
                    showResult('save-test-result', '✅ 存档系统测试通过！本地存储功能正常。', true);
                } else {
                    showResult('save-test-result', '❌ 存档系统测试失败！数据读写错误。', false);
                }
            } catch (error) {
                showResult('save-test-result', '❌ 存档系统测试失败！错误：' + error.message, false);
            }
        }

        function testEquipmentSystem() {
            try {
                // 检查Equipment和Item类是否存在
                if (typeof Equipment === 'undefined' || typeof Item === 'undefined') {
                    showResult('equipment-test-result', 'Equipment或Item类未找到，请确保equipment-system.js已正确加载', false);
                    return;
                }

                // 创建测试物品
                const testItem = new Item({
                    id: 'test_item',
                    name: '测试物品',
                    type: 'weapon',
                    rarity: 'common',
                    attack: 10,
                    description: '这是一个测试物品'
                });

                if (testItem.name === '测试物品' && testItem.equipmentStats.attack === 10) {
                    showResult('equipment-test-result', '✅ 装备系统测试通过！物品创建和属性正常。', true);
                } else {
                    showResult('equipment-test-result', '❌ 装备系统测试失败！物品属性错误。', false);
                }
            } catch (error) {
                showResult('equipment-test-result', '❌ 装备系统测试失败！错误：' + error.message, false);
            }
        }

        function testAudioSystem() {
            try {
                // 检查AudioManager类是否存在
                if (typeof AudioManager === 'undefined') {
                    showResult('audio-test-result', 'AudioManager类未找到，请确保audio-manager.js已正确加载', false);
                    return;
                }

                // 检查Web Audio API支持
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();

                if (audioContext.state === 'suspended') {
                    // 需要用户交互才能启动
                    showResult('audio-test-result', '✅ 音效系统测试通过！AudioContext已创建（需要用户交互才能播放）。', true);
                } else if (audioContext.state === 'running') {
                    showResult('audio-test-result', '✅ 音效系统测试通过！AudioContext正在运行。', true);
                } else {
                    showResult('audio-test-result', '✅ 音效系统测试通过！AudioContext状态：' + audioContext.state, true);
                }

                audioContext.close();
            } catch (error) {
                showResult('audio-test-result', '❌ 音效系统测试失败！错误：' + error.message, false);
            }
        }

        function testBattleSystem() {
            try {
                // 检查战斗相关的代码是否加载
                if (typeof Game === 'undefined') {
                    showResult('battle-test-result', 'Game类未找到，请确保game.js已正确加载', false);
                    return;
                }

                // 模拟战斗数据结构
                const mockBattle = {
                    player: {
                        attack: 100,
                        defense: 50,
                        health: 200,
                        maxHealth: 200
                    },
                    enemy: {
                        attack: 80,
                        defense: 30,
                        health: 150,
                        maxHealth: 150
                    }
                };

                // 测试伤害计算逻辑
                const baseDamage = mockBattle.player.attack;
                const defense = mockBattle.enemy.defense;
                const randomFactor = Math.floor(Math.random() * 10) - 5;
                const damage = Math.max(1, baseDamage - defense + randomFactor);

                if (damage > 0 && damage <= baseDamage) {
                    showResult('battle-test-result', '✅ 战斗系统测试通过！伤害计算逻辑正常。', true);
                } else {
                    showResult('battle-test-result', '❌ 战斗系统测试失败！伤害计算异常：' + damage, false);
                }
            } catch (error) {
                showResult('battle-test-result', '❌ 战斗系统测试失败！错误：' + error.message, false);
            }
        }

        function startGame() {
            try {
                // 检查所有必要的类是否已加载
                const requiredClasses = ['Game', 'SaveManager', 'Equipment', 'Item', 'AudioManager'];
                const missingClasses = requiredClasses.filter(className => typeof window[className] === 'undefined');

                if (missingClasses.length > 0) {
                    showResult('game-start-result', '❌ 游戏启动失败！缺少类：' + missingClasses.join(', '), false);
                    return;
                }

                // 检查HTML元素是否存在
                const requiredElements = ['character-select', 'game-screen', 'battle-screen'];
                const missingElements = requiredElements.filter(elementId => !document.getElementById(elementId));

                if (missingElements.length > 0) {
                    showResult('game-start-result', '❌ 游戏启动失败！缺少HTML元素：' + missingElements.join(', '), false);
                    return;
                }

                showResult('game-start-result', '✅ 游戏启动测试通过！所有必要组件已加载。可以开始游戏了！', true);

                // 3秒后自动跳转到游戏
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 3000);
            } catch (error) {
                showResult('game-start-result', '❌ 游戏启动测试失败！错误：' + error.message, false);
            }
        }

        // 页面加载完成后自动运行基础测试
        window.addEventListener('load', () => {
            console.log('🎮 AI山海经系统测试页面已加载');
            console.log('📝 请点击上方按钮进行各项系统测试');
        });
    </script>
</body>
</html>