<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIå±±æµ·ç»ç³»ç»Ÿæµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f0f0f0;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-section h3 {
            margin-top: 0;
            color: #333;
        }
        .test-button {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #2980b9;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
            background: #ecf0f1;
        }
        .success {
            background: #d5f4e6;
            color: #27ae60;
        }
        .error {
            background: #fadbd8;
            color: #e74c3c;
        }
        .feature-list {
            list-style-type: none;
            padding: 0;
        }
        .feature-list li {
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        .feature-list li:last-child {
            border-bottom: none;
        }
        .shortcut {
            background: #34495e;
            color: white;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>AIå±±æµ·ç»ç³»ç»Ÿæµ‹è¯•</h1>

        <div class="test-section">
            <h2>æ–°å¢åŠŸèƒ½æ€»è§ˆ</h2>
            <ul class="feature-list">
                <li><strong>å­˜æ¡£ç³»ç»Ÿ</strong> - æ”¯æŒå¤šæ§½ä½å­˜æ¡£ã€è‡ªåŠ¨å­˜æ¡£ã€è¯»æ¡£åŠŸèƒ½</li>
                <li><strong>è£…å¤‡ç³»ç»Ÿ</strong> - å®Œæ•´çš„è£…å¤‡æ ã€èƒŒåŒ…ã€ç‰©å“æ‰è½ç³»ç»Ÿ</li>
                <li><strong>éŸ³æ•ˆç³»ç»Ÿ</strong> - Web Audio APIéŸ³æ•ˆç”Ÿæˆã€èƒŒæ™¯éŸ³ä¹ã€éŸ³æ•ˆæ§åˆ¶</li>
                <li><strong>æˆ˜æ–—å¢å¼º</strong> - è£…å¤‡å±æ€§åŠ æˆã€æš´å‡»ç‡ã€é—ªé¿ç‡</li>
                <li><strong>ç”¨æˆ·ç•Œé¢</strong> - æ–°çš„å¿«æ·é”®ã€æ§åˆ¶æç¤ºã€éŸ³æ•ˆæ§åˆ¶é¢æ¿</li>
            </ul>
        </div>

        <div class="test-section">
            <h2>å¿«æ·é”®è¯´æ˜</h2>
            <ul class="feature-list">
                <li><span class="shortcut">F5</span> - å¿«é€Ÿå­˜æ¡£ï¼ˆæ§½ä½1ï¼‰</li>
                <li><span class="shortcut">F9</span> - å¿«é€Ÿè¯»æ¡£ï¼ˆæ§½ä½1ï¼‰</li>
                <li><span class="shortcut">F6</span> - æ‰“å¼€å­˜æ¡£ç•Œé¢</li>
                <li><span class="shortcut">I</span> - æ‰“å¼€è£…å¤‡ç•Œé¢</li>
                <li><span class="shortcut">WASD</span> - ç§»åŠ¨è§’è‰²</li>
                <li><span class="shortcut">é¼ æ ‡ç‚¹å‡»</span> - å¯»è·¯ç§»åŠ¨</li>
                <li><span class="shortcut">J/K/L</span> - é‡Šæ”¾æŠ€èƒ½</li>
            </ul>
        </div>

        <div class="test-section">
            <h3>å­˜æ¡£ç³»ç»Ÿæµ‹è¯•</h3>
            <button class="test-button" onclick="testSaveSystem()">æµ‹è¯•å­˜æ¡£ç³»ç»Ÿ</button>
            <div id="save-test-result" class="test-result" style="display:none;"></div>
        </div>

        <div class="test-section">
            <h3>è£…å¤‡ç³»ç»Ÿæµ‹è¯•</h3>
            <button class="test-button" onclick="testEquipmentSystem()">æµ‹è¯•è£…å¤‡ç³»ç»Ÿ</button>
            <div id="equipment-test-result" class="test-result" style="display:none;"></div>
        </div>

        <div class="test-section">
            <h3>éŸ³æ•ˆç³»ç»Ÿæµ‹è¯•</h3>
            <button class="test-button" onclick="testAudioSystem()">æµ‹è¯•éŸ³æ•ˆç³»ç»Ÿ</button>
            <div id="audio-test-result" class="test-result" style="display:none;"></div>
        </div>

        <div class="test-section">
            <h3>æˆ˜æ–—ç³»ç»Ÿæµ‹è¯•</h3>
            <button class="test-button" onclick="testBattleSystem()">æµ‹è¯•æˆ˜æ–—ç³»ç»Ÿ</button>
            <div id="battle-test-result" class="test-result" style="display:none;"></div>
        </div>

        <div class="test-section">
            <h3>æ¸¸æˆå¯åŠ¨æµ‹è¯•</h3>
            <button class="test-button" onclick="startGame()">å¯åŠ¨å®Œæ•´æ¸¸æˆ</button>
            <div id="game-start-result" class="test-result" style="display:none;"></div>
        </div>
    </div>

    <script>
        function showResult(elementId, message, isSuccess) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = 'test-result ' + (isSuccess ? 'success' : 'error');
            element.style.display = 'block';
        }

        function testSaveSystem() {
            try {
                // æ£€æŸ¥SaveManagerç±»æ˜¯å¦å­˜åœ¨
                if (typeof SaveManager === 'undefined') {
                    showResult('save-test-result', 'SaveManagerç±»æœªæ‰¾åˆ°ï¼Œè¯·ç¡®ä¿save-manager.jså·²æ­£ç¡®åŠ è½½', false);
                    return;
                }

                // æµ‹è¯•æœ¬åœ°å­˜å‚¨åŠŸèƒ½
                const testSaveData = {
                    test: true,
                    timestamp: Date.now()
                };
                localStorage.setItem('test_save', JSON.stringify(testSaveData));
                const loadedData = JSON.parse(localStorage.getItem('test_save'));

                if (loadedData.test === true) {
                    showResult('save-test-result', 'âœ… å­˜æ¡£ç³»ç»Ÿæµ‹è¯•é€šè¿‡ï¼æœ¬åœ°å­˜å‚¨åŠŸèƒ½æ­£å¸¸ã€‚', true);
                } else {
                    showResult('save-test-result', 'âŒ å­˜æ¡£ç³»ç»Ÿæµ‹è¯•å¤±è´¥ï¼æ•°æ®è¯»å†™é”™è¯¯ã€‚', false);
                }
            } catch (error) {
                showResult('save-test-result', 'âŒ å­˜æ¡£ç³»ç»Ÿæµ‹è¯•å¤±è´¥ï¼é”™è¯¯ï¼š' + error.message, false);
            }
        }

        function testEquipmentSystem() {
            try {
                // æ£€æŸ¥Equipmentå’ŒItemç±»æ˜¯å¦å­˜åœ¨
                if (typeof Equipment === 'undefined' || typeof Item === 'undefined') {
                    showResult('equipment-test-result', 'Equipmentæˆ–Itemç±»æœªæ‰¾åˆ°ï¼Œè¯·ç¡®ä¿equipment-system.jså·²æ­£ç¡®åŠ è½½', false);
                    return;
                }

                // åˆ›å»ºæµ‹è¯•ç‰©å“
                const testItem = new Item({
                    id: 'test_item',
                    name: 'æµ‹è¯•ç‰©å“',
                    type: 'weapon',
                    rarity: 'common',
                    attack: 10,
                    description: 'è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•ç‰©å“'
                });

                if (testItem.name === 'æµ‹è¯•ç‰©å“' && testItem.equipmentStats.attack === 10) {
                    showResult('equipment-test-result', 'âœ… è£…å¤‡ç³»ç»Ÿæµ‹è¯•é€šè¿‡ï¼ç‰©å“åˆ›å»ºå’Œå±æ€§æ­£å¸¸ã€‚', true);
                } else {
                    showResult('equipment-test-result', 'âŒ è£…å¤‡ç³»ç»Ÿæµ‹è¯•å¤±è´¥ï¼ç‰©å“å±æ€§é”™è¯¯ã€‚', false);
                }
            } catch (error) {
                showResult('equipment-test-result', 'âŒ è£…å¤‡ç³»ç»Ÿæµ‹è¯•å¤±è´¥ï¼é”™è¯¯ï¼š' + error.message, false);
            }
        }

        function testAudioSystem() {
            try {
                // æ£€æŸ¥AudioManagerç±»æ˜¯å¦å­˜åœ¨
                if (typeof AudioManager === 'undefined') {
                    showResult('audio-test-result', 'AudioManagerç±»æœªæ‰¾åˆ°ï¼Œè¯·ç¡®ä¿audio-manager.jså·²æ­£ç¡®åŠ è½½', false);
                    return;
                }

                // æ£€æŸ¥Web Audio APIæ”¯æŒ
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();

                if (audioContext.state === 'suspended') {
                    // éœ€è¦ç”¨æˆ·äº¤äº’æ‰èƒ½å¯åŠ¨
                    showResult('audio-test-result', 'âœ… éŸ³æ•ˆç³»ç»Ÿæµ‹è¯•é€šè¿‡ï¼AudioContextå·²åˆ›å»ºï¼ˆéœ€è¦ç”¨æˆ·äº¤äº’æ‰èƒ½æ’­æ”¾ï¼‰ã€‚', true);
                } else if (audioContext.state === 'running') {
                    showResult('audio-test-result', 'âœ… éŸ³æ•ˆç³»ç»Ÿæµ‹è¯•é€šè¿‡ï¼AudioContextæ­£åœ¨è¿è¡Œã€‚', true);
                } else {
                    showResult('audio-test-result', 'âœ… éŸ³æ•ˆç³»ç»Ÿæµ‹è¯•é€šè¿‡ï¼AudioContextçŠ¶æ€ï¼š' + audioContext.state, true);
                }

                audioContext.close();
            } catch (error) {
                showResult('audio-test-result', 'âŒ éŸ³æ•ˆç³»ç»Ÿæµ‹è¯•å¤±è´¥ï¼é”™è¯¯ï¼š' + error.message, false);
            }
        }

        function testBattleSystem() {
            try {
                // æ£€æŸ¥æˆ˜æ–—ç›¸å…³çš„ä»£ç æ˜¯å¦åŠ è½½
                if (typeof Game === 'undefined') {
                    showResult('battle-test-result', 'Gameç±»æœªæ‰¾åˆ°ï¼Œè¯·ç¡®ä¿game.jså·²æ­£ç¡®åŠ è½½', false);
                    return;
                }

                // æ¨¡æ‹Ÿæˆ˜æ–—æ•°æ®ç»“æ„
                const mockBattle = {
                    player: {
                        attack: 100,
                        defense: 50,
                        health: 200,
                        maxHealth: 200
                    },
                    enemy: {
                        attack: 80,
                        defense: 30,
                        health: 150,
                        maxHealth: 150
                    }
                };

                // æµ‹è¯•ä¼¤å®³è®¡ç®—é€»è¾‘
                const baseDamage = mockBattle.player.attack;
                const defense = mockBattle.enemy.defense;
                const randomFactor = Math.floor(Math.random() * 10) - 5;
                const damage = Math.max(1, baseDamage - defense + randomFactor);

                if (damage > 0 && damage <= baseDamage) {
                    showResult('battle-test-result', 'âœ… æˆ˜æ–—ç³»ç»Ÿæµ‹è¯•é€šè¿‡ï¼ä¼¤å®³è®¡ç®—é€»è¾‘æ­£å¸¸ã€‚', true);
                } else {
                    showResult('battle-test-result', 'âŒ æˆ˜æ–—ç³»ç»Ÿæµ‹è¯•å¤±è´¥ï¼ä¼¤å®³è®¡ç®—å¼‚å¸¸ï¼š' + damage, false);
                }
            } catch (error) {
                showResult('battle-test-result', 'âŒ æˆ˜æ–—ç³»ç»Ÿæµ‹è¯•å¤±è´¥ï¼é”™è¯¯ï¼š' + error.message, false);
            }
        }

        function startGame() {
            try {
                // æ£€æŸ¥æ‰€æœ‰å¿…è¦çš„ç±»æ˜¯å¦å·²åŠ è½½
                const requiredClasses = ['Game', 'SaveManager', 'Equipment', 'Item', 'AudioManager'];
                const missingClasses = requiredClasses.filter(className => typeof window[className] === 'undefined');

                if (missingClasses.length > 0) {
                    showResult('game-start-result', 'âŒ æ¸¸æˆå¯åŠ¨å¤±è´¥ï¼ç¼ºå°‘ç±»ï¼š' + missingClasses.join(', '), false);
                    return;
                }

                // æ£€æŸ¥HTMLå…ƒç´ æ˜¯å¦å­˜åœ¨
                const requiredElements = ['character-select', 'game-screen', 'battle-screen'];
                const missingElements = requiredElements.filter(elementId => !document.getElementById(elementId));

                if (missingElements.length > 0) {
                    showResult('game-start-result', 'âŒ æ¸¸æˆå¯åŠ¨å¤±è´¥ï¼ç¼ºå°‘HTMLå…ƒç´ ï¼š' + missingElements.join(', '), false);
                    return;
                }

                showResult('game-start-result', 'âœ… æ¸¸æˆå¯åŠ¨æµ‹è¯•é€šè¿‡ï¼æ‰€æœ‰å¿…è¦ç»„ä»¶å·²åŠ è½½ã€‚å¯ä»¥å¼€å§‹æ¸¸æˆäº†ï¼', true);

                // 3ç§’åè‡ªåŠ¨è·³è½¬åˆ°æ¸¸æˆ
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 3000);
            } catch (error) {
                showResult('game-start-result', 'âŒ æ¸¸æˆå¯åŠ¨æµ‹è¯•å¤±è´¥ï¼é”™è¯¯ï¼š' + error.message, false);
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨è¿è¡ŒåŸºç¡€æµ‹è¯•
        window.addEventListener('load', () => {
            console.log('ğŸ® AIå±±æµ·ç»ç³»ç»Ÿæµ‹è¯•é¡µé¢å·²åŠ è½½');
            console.log('ğŸ“ è¯·ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®è¿›è¡Œå„é¡¹ç³»ç»Ÿæµ‹è¯•');
        });
    </script>
</body>
</html>